<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Room</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.4.0/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
    <script src="/script/game.js"></script> <!-- 별도의 JS 파일로 관리하는 것을 권장 -->
    <style>
        /* 기존 스타일 유지 */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            vertical-align: middle;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
            text-align: center;
        }
        .ready-true {
            color: green;
            font-weight: bold;
        }
        .ready-false {
            color: red;
            font-weight: bold;
        }
        .admin {
            background-color: #ffd700;
        }
        .start-btn, .ready-btn {
            padding: 5px 10px;
            margin: 2px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .start-btn {
            background-color: #4CAF50; /* Green */
            color: white;
        }
        .ready-btn {
            background-color: #008CBA; /* Blue */
            color: white;
        }
        .start-btn:hover {
            background-color: #45a049;
        }
        .ready-btn:hover {
            background-color: #007bb5;
        }
    </style>
</head>
<body>
<h1>Room Information</h1>
<p><strong>Room ID: </strong><span th:text="${roomInfo.roomId}"></span></p>
<p><strong>Room Name: </strong><span th:text="${roomInfo.roomName}"></span></p>
<p><strong>Topic ID: </strong><span th:text="${roomInfo.topicId}"></span></p>
<p><strong>Max People: </strong><span th:text="${roomInfo.maxPeople}"></span></p>
<p><strong>Quiz Count: </strong><span th:text="${roomInfo.quizCount}"></span></p>

<h2>Users in Room</h2>
<table id="userTable">
    <thead>
    <tr>
        <th>User ID</th>
        <th>User Name</th>
        <th>Ready Status</th>
        <th>Actions</th> <!-- "Role" 대신 "Actions" 열로 변경 -->
    </tr>
    </thead>
    <tbody id="participants">
    <tr th:each="participant : ${roomInfo.participants}">
        <td th:text="${participant.id}"></td>
        <td th:text="${participant.username}"></td>
        <td th:text="${participant.readyStatus ? 'Ready' : 'Not Ready'}"
            th:classappend="${participant.readyStatus ? 'ready-true' : 'ready-false'}"></td>
        <td>
            <!-- Admin 참가자에게만 "Start Game" 버튼 표시 -->
            <button th:if="${roomInfo.isAdmin and participant.role == T(com.example.quiz.enums.Role).ADMIN}"
                    th:attr="data-user-id=${participant.id}"
                    class="start-btn">
                Start Game
            </button>
            <!-- User 참가자에게만 "Toggle Ready" 버튼 표시 -->
            <button th:if="${!roomInfo.isAdmin and participant.role == T(com.example.quiz.enums.Role).USER}"
                    th:attr="data-user-id=${participant.id}"
                    class="ready-btn">
                Toggle Ready
            </button>
        </td>
    </tr>
    </tbody>
</table>

<!-- 디버깅을 위한 참가자 목록 출력 (옵션) -->
<h2>Participants List (디버깅용)</h2>
<ul>
    <li th:each="participant : ${roomInfo.participants}"
        th:text="'ID: ' + ${participant.id} + ', Name: ' + ${participant.username} + ', Ready: ' + (${participant.readyStatus} ? 'Yes' : 'No') + ', Role: ' + (${participant.role == T(com.example.quiz.enums.Role).ADMIN ? 'ADMIN' : 'USER'})">
    </li>
</ul>

</body>
</html>